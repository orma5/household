<!-- MOBILE SIDEBAR COMPONENT -->
<div class="modal fade" id="mobileSidebar" tabindex="-1" aria-labelledby="mobileSidebarLabel" aria-hidden="true">
  <div class="modal-dialog modal-fullscreen-sm-down m-0">
    <div class="modal-content" style="background-color: #BCB6FF;">
      <div class="modal-header border-0">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body d-flex flex-column align-items-center text-dark text-center">
        <!-- Brand -->
        <a href="/" class="mb-3 text-dark text-decoration-none d-flex flex-column align-items-center">
          <i class="bi bi-house-gear-fill fs-3"></i>
          <span class="fs-5 fw-semibold mt-1">Keep-App</span>
          {% if account %}
            <span class="small fw-medium text-muted">{{ account.name }}</span>
          {% endif %}
        </a>

        <hr class="text-dark w-100" />

        <!-- Location Context -->
        {% if active_location %}
        <div class="w-100 px-3 mb-3 text-start">
             <button class="btn btn-light w-100 shadow-sm d-flex align-items-center justify-content-between p-2 rounded-3" 
                     type="button" 
                     data-bs-toggle="collapse" 
                     data-bs-target="#mobileLocationCollapse" 
                     aria-expanded="false">
                <div class="d-flex align-items-center gap-2 overflow-hidden">
                    <i class="bi bi-geo-alt-fill text-success"></i>
                    <span class="fw-bold text-truncate">{{ active_location.name }}</span>
                </div>
                <i class="bi bi-chevron-down small"></i>
             </button>
             
             <div class="collapse mt-2" id="mobileLocationCollapse">
                <div class="card card-body p-2 shadow-sm border-0 text-start">
                    <h6 class="text-uppercase small fw-bold text-muted mb-2 ps-2">Switch Location</h6>
                    {% for loc in user_locations %}
                    <a class="dropdown-item p-2 mb-1 rounded-3 d-flex align-items-center gap-3" 
                       href="{% url 'switch-location' loc.id %}"
                       style="white-space: normal;">
                        <div class="rounded-circle d-flex justify-content-center align-items-center flex-shrink-0" 
                             style="width: 32px; height: 32px; background-color: {% if loc.id == active_location.id %}var(--green-color){% else %}#f8f9fa{% endif %};">
                          <i class="bi bi-house-door-fill {% if loc.id == active_location.id %}text-dark{% else %}text-secondary{% endif %}"></i>
                        </div>
                        <span class="fw-medium text-dark lh-sm">{{ loc.name }}</span>
                        {% if loc.id == active_location.id %}
                            <i class="bi bi-check-lg text-success ms-auto"></i>
                        {% endif %}
                    </a>
                    {% endfor %}
                    <hr class="my-1">
                    <a class="dropdown-item p-2 text-center small text-muted" href="{% url 'settings-view' %}">Manage Locations</a>
                </div>
             </div>
        </div>
        {% endif %}

        <!-- Menu -->
        <ul class="nav flex-column mb-auto w-100">
          <li class="nav-item mb-3">
            <a href="{% url 'home' %}" class="nav-link text-dark d-flex flex-column align-items-center">
              <i class="bi bi-columns fs-5"></i>
              <span class="mt-1">Overview</span>
            </a>
          </li>
          <li class="nav-item mb-3">
            <a href="{% url 'task-due-list' %}" class="nav-link text-dark d-flex flex-column align-items-center">
              <i class="bi bi-clipboard2-check fs-5"></i>
              <span class="mt-1">ToDo</span>
            </a>
          </li>
          <li class="nav-item mb-3">
            <a href="{% url 'task-management-list' %}" class="nav-link text-dark d-flex flex-column align-items-center">
              <i class="bi bi-list-check fs-5"></i>
              <span class="mt-1">Task list</span>
            </a>
          </li>
          <li class="nav-item mb-3">
            <a href="{% url 'item-list' %}" class="nav-link text-dark d-flex flex-column align-items-center">
              <i class="bi bi-box fs-5"></i>
              <span class="mt-1">Item Inventory</span>
            </a>
          </li>
          <li class="nav-item mb-3">
            <a href="{% url 'settings-view' %}" class="nav-link text-dark d-flex flex-column align-items-center">
              <i class="bi bi-gear fs-5"></i>
              <span class="mt-1">Settings</span>
            </a>
          </li>
        </ul>

        <!-- Log out -->
        <div class="mt-auto w-100">
          <form method="post" class="d-flex flex-column" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-link text-dark text-decoration-none d-flex flex-column align-items-center">
              <i class="bi bi-box-arrow-left fs-5"></i>
              <span class="mt-1">Log out</span>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>